---
title: "ecorest: Generic Platform for Index-Based Modeling"
author: "S. Kyle McKay, Darixa D. Hern√°ndez-Abrams, Rachel L. Nifong, and Todd M. Swannack"
date: "August 2020"
output:
  html_document:
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: no
      smooth_scroll: yes
  word_document:
    toc: yes
    toc_depth: '4'
---
```{r options, echo=FALSE, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE) 
```


## **Abstract**   

The U.S. Army Corps of Engineers (USACE) engages in a large variety of decisions affecting ecological outcomes such as ecosystem restoration of oyster reefs, environmental flows for imperiled fishes, and bird breeding grounds impacted by dredge material management. A common approach to ecological modeling of environmental impacts and benefits is based on the quantity and quality of habitats. No standard modeling platform for exists for computing outcomes from the "index" models, and users often develop ad hoc spreadsheet models. Here, we present a generic, flexible, error-checked index modeling platform applicable Nationwide, which we refer to as the "ecorest" modeling framework. Four modules compose this framework. First, model parameters are compiled as a data set and associated metadata for over 500 habitat suitability models developed by the U.S. Fish and Wildlife Service. Second, functions are presented for conducting habitat suitability analyses for both the models described above as well as generic user-specified model parameterizations. Third, a suite of decision support tools are presented for conducting cost-effectiveness and incremental cost analyses. These three modules are all contained within an open source modeling package for the R Statistical Software Language called [`ecorest`](https://cran.r-project.org/web/packages/ecorest/index.html). The fourth module develops a graphical user interface for these models as a web application (*Insert Website Later*). This modeling platform seeks to standardize availability and application of index models within the USACE.


*Author Headnotes*:  

* Corresponding Author: S. Kyle McKay, U.S. Army Engineer Research and Development Center (ERDC), Environmental Laboratory (EL), New York, New York, Office: 917-790-8717, Cell: 970-980-9747, kyle.mckay@usace.army.mil  
* This report provides an overview of development of an ecological modeling platform for USACE model certification. Model source code has been previously reviewed and released as the [`ecorest`](https://cran.r-project.org/web/packages/ecorest/index.html) "package" by the Comprehensive R Archival Network ([CRAN](https://cran.r-project.org/)). This report is simultaneously undergoing peer review as an ERDC Technical Report.  
* All analyses are conducted in the (ACE-IT approved) R Statistical Software.  
* Color schemes may seem non-traditional (i.e., non-rainbow arrays), but colors were chosen for maximum understanding by color deficient audiences. Nationwide, approximately 8% of men and 0.5% of women exhibit some form of color deficiency. In USACE, supervisors (GS-13 or higher) are ~74% male and ~26% female, which results in a 6% chance of a team member exhibiting color-blindness (1 out of 17). Among USACE decision makers, army officers (O4 or higher) are ~85% male and ~15% female, which results in a 7% chance of a team member exhibiting color-blindness (1 out of 15). Specifically, `ecorest` uses [viridis](https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html) color schemes. 


```{r}
#Clear local memory
rm(list=ls(all=TRUE))

##########
#Load all necessary R packages
#library(viridis)    #Contains color-blind friendly color schemes
library(ecorest)    #Contains habitat suitability and CEICA models
```


## **1. Background**

Across all business lines, the U.S. Army Corps of Engineers (USACE) engages in a large variety of decisions that affect a multitude ecological outcomes (e.g., ecosystem restoration of oyster reefs, environmental flows for imperiled fishes, and bird breeding grounds impacted by dredge material management). While numerous aquatic, riparian, and terrestrial analytical tools exist, ecological models typically have not been easily accessible or in the most usable form for field practitioners and often require significant data and modeling expertise to effectively employ. However, ecological models must be used to quantify environmental impacts and benefits throughout the project life-cycle of planning, engineering, construction, operations, and maintenance. 

A common approach to ecological modeling of environmental impacts and benefits is based on quantity and quality of habitat. These "index" models (Swannack et al. 2012) were originally developed for species-specific applications (e.g., slider turtles), but the general approach has also been adapted to guilds (e.g., salmonids), communities (e.g., floodplain vegetation), and ecosystem processes (e.g., the Hydrogeomorphic Method). No standard platform for exists for computing outcomes from index models, and users often develop ad hoc spreadsheet models, which are highly prone to numerical errors (McKay 2009). The common quantity-quality structure of index models provides an opportunity to develop a consistent, error-checked index modeling calculator adaptable to a variety of applications across the Corps.

Furthermore, ecological modeling often seeks to inform trade-offs between a monetary assessment of social benefits or costs (e.g., restoration investment cost or economic damages avoided) and a non-monetary assessment of environmental benefits and costs (e.g., habitat gains of restoration or impact to an imperiled taxa's habitat). Cost-effectiveness and incremental cost analyses (CEICA) provide a useful set of techniques for comparing non-monetary and monetary costs and benefits of management actions (Robinson et al. 1995). CEICA is commonly applied in planning and designing ecosystem restoration projects and is often coupled with index models to inform management decisions.  


#### *1.1 Problem Statement*

This document describes a set of computational tools for asssessing ecological outcomes with index models and informing trade-offs between monetary and non-monetary outcomes. The following topics guided the scope this analysis:  

* *Model Purpose*: Ad hoc development of index models is leading to significant USACE investments in computational tool development, user learning, model review, and certification. This platform seeks to provide an error-checked, computationally accurate tool for assessing ecological outcomes with index models. Furthermore, the platform should also provide seamless integration of decision support tools to avoid potential errors associated with data transfer between separate ecological and decision models.  
* *Target Application*: This toolkit is intended primarily for USACE ecosystem restoration planning; however, index models are also often applied for impact assessment, compensatory mitigation, and wetland regulatory issues.  
* *Target Users:* The primary audience for these tools is USACE planners, biologists, and engineers involved in ecosystem restoration projects.  
* *Model Engine vs. User-Interface:* This document addresses the development of computational engines for index models and decision support tools, both of which are developed as the `ecorest` "package" for broad distribution via the [R statistical software language](https://cran.r-project.org/). The R-package may be accessed through the (ACE-IT approved) R freeware and associated user-interfaces such as [RStudio](https://rstudio.com/). The models may also be accessed through a "point-and-click" user interface via a simple web application.  
* *Modular Design:* All model capability is developed as separate databases and functions, which can be accessed independently. For instance, the toolkit is intended to provide "one stop shopping" for USACE restoration planning needs by integrating index and decision support models. However, users may also use non-index models (e.g., population demography models via `popbio`) to examine other ecological outcomes in the decision modules. Likewise, users could compute index model outcomes without using decision support tools.  


**Ultimately, the overarching objective of this model is to develop a technically sound and computationally accurate suite of tools for assessing ecosystem restoration project planning with index models, which are easily accessible use by USACE planners, biologists, and engineers.** This report describes the development of a suite of restoration modeling tools called `ecorest`. While developed for ecosystem restoration applications, the tools may be applied in a variety of other contexts including impact assessment and non-restoration cost-benefit analysis. 


#### *1.2. Model Development Process*  


Models were developed following a general ecological modeling process of conceptualization, quantification, evaluation, application, and communication (Grant and Swannack 2008). Tools were *conceptualized* based on common approaches to index modeling. Generic functions were then developed to *quantify* index model and decision support outcomes, which were "packed" for use in the R Statistical Software. Models are then *evaluated* relative to their numerical accuracy and usability. Finally, *application and communication* of models is demonstrated through a series of appendices with step-by-step instructional guides and example applications on USACE restoration studies. 

Models were iteratively developed and checked. Functions were initially developed and tested by the authors and other ERDC Environmental Laboratory staff. Models were then expanded and generalized in the form of the `ecorest` R-package, which was subsequently reviewed and posted online via the Comprehensive R Archive Network ([CRAN](https://cran.r-project.org/web/packages/ecorest/index.html)). A web application was developed to provide a "point-and-click" user interface for those without programming expertise. All version of the final `ecorest` package and web application were then formally tested against known verified model outcomes, and example applications were developed for demonstration purposes. 


This report is organized around the modeling process followed. Each section descibes the technical basis of index based models along with their execution in `ecorest`. Report appendices provide additional information about models such as formal testing, user guides, and numerous example applications. This document is intended to provide documentation of the model's technical details, use, and relevant information for USACE model certification (EC 1105-2-412, PB 2013-02).


## **2. Conceptualization**


The `ecorest` platform synthesizes two major analytical approaches within a single numerical framework. First, index models are a common ecological modeling approach used in assessing impacts and benefits of environmental management actions. Second, cost-effectiveness and incremental cost analysis (CEICA) are decision support tools for informing decisions involving non-commensurate metrics such as non-monetary ecological outcomes and monetary costs. Finally, the `ecorest` modeling platform provides a computational workflow for uniting these analyses to inform ecosystem restoration decision-making. The following sections review the conceptual foundation for each of these topics separately.


#### *2.1. Index-Based Ecological Models*  


Ecological models have become common tools for informing decisions related to the management of complex ecological processes. Models span the breadth of their potential ecological management applications such as seafood harvest limits, transport of nutrients into freshwaters, bioaccumulation of contaminants, management of imperiled taxa, and wetland impact assessment. In addition to diverse outcomes, ecological models often take on a variety of theoretical constructs ranging from theoretical, analytical models to statistical correlations of variables to agent-based simulations of animal movement (See Swannack et al. 2012 for a review of ecological model types). The diversity of ecological endpoints and model constructs has led to a wide array of tools applicable to ecosystem management and restoration.  

Index models are a family of techniques commonly applied in planning ecosystem restoration projects. Briefly, index models quantitatively translate multiple features or processes into a relative assessment of habitat suitability for a given organism or a relative assessment of ecosystem condition (Tirpak et al. 2009, Swannack et al. 2012). More specifically, index models combine assessments of habitat or ecosystem quality and quantity into an overarching metric for assessing the relative condition of a site (e.g., a "habitat unit" or "functional capacity unit"). Quantity is commonly expressed as a metric of area such as acres or hectares; however, other metrics may be appropriate to specific applications such as river length or lake volume. Quality is then assessed by identifying key variables correlated with habitat or ecosystem condition. Each variable is then translated into a suitability index curve, which transforms dimensional quantities such as flow velocity into dimensionless values of quality (0 to 1 where 0 is unsuitable/low condition and 1 is suitable/ideal condition). Multiple suitability curves are then combined through various equational forms into an overarching assessment of habitat quality (e.g., a "habitat suitability index" or "functional capacity index"). 

Index models may be derived from a variety of methods and resources. Like all models, many index model developers have emphasized that these algorithms simplify complex ecosystems, and thus, these tools should be considered adaptable hypotheses rather than mechanistic, cause-effect relationships. The value of index models lies in their utility for quantitatively comparing the relative merits of alternative management actions and testing hypotheses. The following represent the most common sources of index models applied to USACE ecosystem restoration projects:  

* *U.S. Fish and Wildlife Service (USFWS) Habitat Suitability Index (HSI) Models:* The HSI approach quantitatively relates potential for species presence to habitat characteristics. Species have complex relationships with their environment, and HSI models provide a simple method for characterizing potential for habitat to support target species across a landscape. The USFWS led the development of 500+ HSI models in the 1970-1980s to support environmental management decisions nationwide (https://www.nwrc.usgs.gov/wdb/pub/hsi/hsiindex.htm). The quantitative relationships between species and habitat were generally based on a combination of literature, field studies, and expert opinion, and the reports are colloquially referred to as the "blue books" because of the blue covers binding the original publications.    
* *Hydrogeomorphic Method (HGM) of Wetland Assessment:* Similarly, the HGM approach is a common technique for rapidly assessing wetland function. The HGM methodology for model development is thoroughly documented (Brinson 1993, Smith et al. 1995), and models are available for 30+ wetland types nationwide (https://wetlands.el.erdc.dren.mil/guidebooks.cfm).  
* *Literature-Based Index Models:* Index models also appear within the peer-reviewed and grey literature in a variety of formats. Some of the original HSI models have been subsequently adapted to local conditions or updated as new data became available (e.g., the bluegill model by Stuber et al. 1982 was adapted by Palesh and Anderson 1990). Models also appear in the peer-reviewed literature as new data become available, such as a recent revision to oyster suitability models which expands the breadth of applicability (Swannack et al. 2014).
* *Project- or Objective-Centric Index Models:* Specific restoration projects may build models unique to a set of project objectives (McKay et al. 2019), which can evolve as a project proceeds from preliminary screening to detailed alternatives analysis (e.g., McKay et al. 2018ab). More recently, Carrillo et al. (2020) proposed a Toolkit for interActive Modeling (TAM), which facilitates development of index models in real-time for mediated modeling workshop settings (Herman et al. 2019).


#### *2.2. Cost-Effectiveness and Incremental Cost Analysis (CEICA)*  


The USACE ecosystem restoration mission was first authorized in the Water Resources Development Act of 1986 with the stated purpose ‚Äú‚Ä¶to restore significant structure, function and dynamic processes that have been degraded‚Äù (USACE 1999, ER 1165-2-501). Given this goal, USACE programs emphasize ecological outcomes (as opposed to social or economic outcomes). Generally, ecological resources may be quantified in a variety of ways ranging from habitat suitability for a focal taxa (e.g., an endangered species) to changes in physical processes (e.g., sediment delivery from geomorphic change) to changes in biological processes (e.g., carbon uptake and storage). In other USACE business lines (e.g., navigation), costs and benefits of actions are compared in monetary terms, and the benefit-cost ratio serves as a crucial decision metric. However, outputs of restoration are typically not monetized, and a different set of methods are required to inform restoration decision-making and address the issue of ‚ÄúIs ecosystem restoration worth the Federal investment?‚Äù In particular, cost-effectiveness and incremental cost analyses provide techniques for comparing non-monetary ecological benefits relative to monetary costs of restoration actions (Robinson et al. 1995).

Cost-effectiveness and incremental cost analyses (CEICA) are analytical tools for assessing the relative benefits and costs of ecosystem restoration actions and informing decisions. Benefits and costs are assessed prior to these analyses using ecological models (e.g., index models) and cost engineering methods, respectively. CEICA may then be conducted at the site scale to compare alternatives at a single location (e.g., no action vs. dam removal vs. fish ladder) or at the system scale to compare relative merits of multiple sites (e.g., no sites vs. Site-A only vs. Site-B only vs. Site-A and Site-B). Within the USACE, the Institute of Water Resources has provided a toolkit for conducting CEICA, the IWR Planning Suite (http://www.iwr.usace.army.mil/Missions/Economics/IWR-Planning-Suite/).

Cost-effectiveness analysis provides a mechanism for examining the efficiency of alternative actions. For any given level of investment, the agency wants to identify the plan with the most return-on-investment (i.e., the most environmental benefits), and for any given level of environmental benefits, the agency wants a plan with the least cost. An ‚Äúefficiency frontier‚Äù identifies all plans that efficiently provide benefits on a per cost basis (i.e., cost-effective plans). These "non-dominated" alternatives compose the Pareto-optimal frontier.

Incremental cost analysis is conducted on the set of cost-effective plans. This technique sequentially compares each plan to all higher cost plans to reveal changes in unit cost as output levels increase and eliminates plans that do not efficiently provide benefits on a per unit cost basis. Specifically, this analysis examines the slope of the cost-effectiveness frontier to isolate how the incremental unit cost ($/unit) increases as the magnitude of environmental benefit increases. Incremental cost analysis is ultimately intended to inform decision-makers about the consequences of increasing unit cost when increasing benefits (i.e., each unit becomes more expensive). Plans emerging from incremental cost analysis efficiently accomplish the objective relative to unit costs and are typically referred to as ‚Äúbest buys‚Äù. Importantly, all ‚Äúbest buys‚Äù are cost-effective, but all cost-effective plans are not best buys.


#### *2.3. `ecorest` Model Workflow*  


Conceptual models provide a useful mechanism for many aspects of ecosystem restoration projects such as increasing understanding about a subject, identifying restoration alternatives, and facilitating dialog among team members (Fischenich 2008, USACE 2011). However,conceptual models also inform the development of quantitative ecological models and can document the general workflow of models (Grant and Swannack 2008, Swannack et al. 2012). Here, a conceptual model is presented to describe the general workflow of the `ecorest` computational platform. A stepwise conceptual model development process (Fischenich 2008) was used to develop the model workflow (Table 1), and Figure 1 summarizes the general flow of logic guiding the development of `ecorest`.


```{r}
#Create empty table
Table1 <- as.data.frame(matrix(NA, nrow = 5, ncol = 2))
colnames(Table1) <- c("Step", "ecorest")

#Specify rows of the table
Table1[1,] <- c("1. State the model objectives.", "To develop a technically sound and computationally accurate suite of tools for assessing ecosystem restoration project planning with index models and informing restoration decisions, which are easily accessible use by USACE planners, biologists, and engineers.")
Table1[2,] <- c("2. Bound the system of interest.", "Index models of ecological systems structured around the quantity and quality of habitat, where quality is defined by a set of independent variables and suitability index curves.")
Table1[3,] <- c("3. Identify critical model components within the system.", "The model platform needs to include six basic elements: (1) a generic format for defining suitability index curves, (2) a library of existing index models developed by the US Fish and Wildlife Service, (3) a computational engine for computing index model outcomes, (4) a computational engine for conducting decision support modelings, (5) a simple, adaptable, and modular input-output structure, and (6) a user friendly interface for audiences without programming experience.")
Table1[4,] <- c("4. Articulate relationships among model components.", "A computational engine may be embedded within a user-friendly interface, both of which can access model inputs and create model outputs.")
Table1[5,] <- c("5. Represent the conceptual model.", "Figure 1 provides an overview of computational workflow for the `ecorest` modeling platform")

##########
#Send output table
rownames(Table1) <- NULL
knitr::kable(Table1, caption="**Table 1. Stepwise development of the SMURF conceptual model (following steps in Fischenich 2008).**") 

```


![**Figure 1. Conceptual workflow of the `ecorest` index and decision support modeling toolkit.**](Fig01.IndexModelCalculator_2020-07-30-Workflow.jpg)


## **3. Quantification**


**RESUME EDITING HERE**

Review of Existing Models: An enormous array of models has been developed for THIS SUBJECT.  Briefly review types and constraints of other models.  Why is a new model needed?  Are their prior tools being built from?

Theoretical basis: Is there a population modeling framework?  Are there nutrient cycling theories being captured?  Is there a prior field framework?  Cite literature explaining the mechanisms being captured in the model.

Modeling approach: What basic modeling approach (index, agent, nutrient flow)?  Input requirements (e.g., few parameters vs. extensive geospatial layers), and the degree of development (e.g., long history vs. ad hoc)?  Key assumptions and limitations (bulleted or listed) ‚Äì scope of the model, caveats, what does the modeler want the user to know about its soft-underbelly.

Scale: Review the treatment of time (time step, simulation period) and space (lumped v. explicit).  

Functional form: Insert the formulae, algorithms, equations, variables, etc.  Insert math.  

Numerical Toolkit: What number cruncher is being used (language)?  Who developed it?  How is it used?  Input-output workflow (data format and processing).  What are the model specs (software / hardware requirements)?  Training / users?   

First, a common data structure was developed for index models, data were compiled for existing habitat suitability index (HSI) models, and a Toolkit for interActive Modeling (TAM) was developed to facilitate development of new index models (Carrillo et al. 2019). Second, an engine was developed for computing index models with functions for both generic model evaluation outputs (e.g., suitability curve visualization and sensitivity analysis) and application-specific outputs (e.g., forecasts of with and without project conditions). Third, a series of functions were developed to conduct cost-effectiveness and incremental cost analyses (CEICA), which can be applied to index model outputs or any other trade-off between benefits and costs. These three topics are synthesized into a R-package and will be the focus of this report. Future activities will include the development of a user interface for calling these data and functions (without prior programming expertise) along with associated user manuals and guidance documents.

US Fish and Wildlife Service. (1980a). Habitat as a basis for environmental assessment. Ecological Services Manual, 101.

US Fish and Wildlife Service. (1980b). Habitat Evaluation Procedures (HEP). Ecological Services Manual, 102.

US Fish and Wildlife Service. (1981). Standards for the Development of Habitat Suitability Index Models. Ecological Services Manual, 103.


Background on R


#### *3.1. USFWS Habitat Suitability Model Data*  


**Insert introductory text.**


*`HSImodels$modelname`*

This list of data frames contains 519 U.S. Fish and Wildlife Service Habitat suitability index (HSI) models. A list with 519 data frames each containing an HSI model with multiple independent variables and associated habitat suitability indices (a 0 to 1 value). Data represent break points in curves with linear extrapolation between. Categorical input variables are coded as letters. A comprehensive listing of all models is included in Appendix B. Variable names often required abbreviation, and all nomenclature is also summarized in Appendix B. Table 2 provides and example of one such HSI model for barred owl model (Allen 1987). All models can be called with the corresponding model name using `HSImodels$modelname` (e.g., `HSImodels$barredowl`).

```{r}
Table2 <- HSImodels$barredowl
knitr::kable(Table2, caption="**Table 2. Example of USFWS Habitat Suitability Model Data: Barred Owl (Allen 1987).**")

```

*`HSImetadata`*

This data frame contains metadata for 519 U.S. Fish and Wildlife Service Habitat suitability index (HSI) models, such as model names, documentation, and websites for documentation among other fields. Table 3 provides a full listing of all fields contained within `HSImetadata` along with an example for the barred owl model (Allen 1987).


```{r}
#Variable descriptions from R-package
Table3 <- data.frame(c("Model name", "Model specifications", "Scientific nomenclature of modeled taxa", "Geographic range of organism", "Type of habitat", "Citation of original model", "Conditions under which model may be applied", "Link to original individual model source", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Suitability index values for each organism specific condition", "Food component equation", "Cover component equation", "Cover-food component equation", "Winter food component", "Water component", "Cover breeding component", "Cover nesting component", "Water quality component", "Reproduction component", "Cover reproduction component", "Disturbance component", "Other component", "Larval component", "Embryo and larval component", "Embryo component", "Juvenile component", "Fry component", "Spawning component", "Adult component", "Island component", "Non-island component", "Winter cover food component", "Topography component", "Juvenile adult component", "HSI overarching model equation in R syntax"))

#Variable names from R-package
Table3$names <- colnames(HSImetadata)

#Isolate barred owl model on row 32 (which(HSImetadata$model=="barredowl"))
Table3$barred <- paste(t(HSImetadata[32,]))

#Send pretty table output
colnames(Table3) <- c("Description", "HSImetadata() Field", "Barred Owl Model Value")
rownames(Table3) <- NULL
knitr::kable(Table3, caption="**Table 3. Example of model information embedded within HSImetadata(): Barred Owl (Allen 1987).**")

```

#### *3.2. Index Model Computational Engine*  


**Insert introductory text.**


*`HSIplotter(SI, figure.name)`*

Plots suitability index curves relative to multiple variables. 

Inputs are:  

* `SI`: a matrix of suitability curves ordered as parameter breakpoints and associated suitability indices for each parameter with appropriate column names.  
* `figure.name`: output figure file name structured as "filename.jpeg".

Function returns a multi-panel *.jpeg figure showing all suitability curves (e.g., Figure 2).

```{r echo=TRUE}
HSIplotter
HSIplotter(HSImodels$barredowl, "Fig02.BarredOwl.jpeg")
```

![**Figure 2. Example output from `HSIplotter()` for the barred owl model (Allen 1987).**](Fig02.BarredOwl.jpeg)

*`SIcalc(SI, input.proj)`*

Computes suitability indices given a set of suitability curves and project-specific inputs. Suitability indices may be computed based on either linear interpolation (for continuous variables) or a lookup method (for categorical variables). 

Inputs are:  

* `SI`: a matrix of suitability curves ordered as parameter breakpoints and associated suitability indices for each parameter with appropriate column names.  
* `input.proj`: numeric or categorical vector of application-specific input parameters associated with the suitability curve data from SI.

Function returns a vector of the suitability index values that match given user inputs. Values are returned as equal to the extreme of a range if inputs are outside of model range.

```{r echo=TRUE}
SIcalc
```


*`HSIarimean(x)`*

Uses arithmetic mean to combine suitability indices into an overarching habitat suitability index.

Inputs are:

* `x`: a vector of suitability indices.  

Function returns a value of habitat quality from 0 to 1 ignoring NA values.

```{r echo=TRUE}
HSIarimean
```


*`HSIwarimean(x, w)`*

Uses a weighted arithmetic mean to combine suitability indices into an overarching habitat suitability index.

Inputs are:

* `x`: a vector of suitability indices.  
* `w`: a vector of weights (0 to 1 values that must sum to one).  

Function returns a value of habitat quality from 0 to 1 ignoring NA values.


```{r echo=TRUE}
HSIwarimean
```


*`HSIgeomean(x)`*

Uses geometric mean to combine suitability indices into an overarching habitat suitability index.

Inputs are:

* `x`: a vector of suitability indices.  

Function returns a value of habitat quality from 0 to 1 ignoring NA values.


```{r echo=TRUE}
HSIgeomean
```


*`HSImin(x)`*

Uses the minimum of given suitability indices to calculate an overarching habitat suitability index.

Inputs are:

* `x`: a vector of suitability indices.  

Function returns a value of habitat quality from 0 to 1 ignoring NA values.


```{r echo=TRUE}
HSImin
```


*`HSIeqtn(HSImodelname, SIV, HSImetadata)`*

Computes a habitat suitability index based on equations specified in USFWS habitat suitability models contained within `ecorest` via `HSImodels` and `HSImetadata`. Habitat suitability indices represent an overall assessment of habitat quality from combining individual suitability indices for multiple independent variables. The function computes an overall habitat suitability index. This function only applies to built-in index models described in Section 3.1.

Inputs are:

* `HSImodelname`: a character string in quotations that must match an existing model name in `HSImetadata`.  
* `SIV`: a vector of suitability index values used in the model specified in `HSImodelname`.  
* `HSImetadata`: a data frame of HSI model metadata within the `ecores`t package.  

Function returns a numeric of the habitat suitability index ranging from 0 to 1.


```{r echo=TRUE}
HSIeqtn
```


*`HUcalc(SI.out, habitat.quantity, HSIfunc, ...)`*

Computes habitat units given a set of suitability indices, a habitat suitability index equation, and habitat quantity.

Inputs are:

* `SI.out`: a vector of application-specific suitability indices, which can be produced from `SIcalc` or other functions.  
* `habitat.quantity`: a numeric of habitat size associated with these suitability indices (i.e., length, area, or volume).  
* `HSIfunc`: a function for combination of the suitability indices.  
* `...`: optional arguments to `HSIfunc`.  

Function returns a vector of habitat quality, habitat quantity, and index units (quantity times quality).


```{r echo=TRUE}
HUcalc
```


#### *3.3. Decision Support Engine*  


**Insert.**


*`annualizer(timevec, benefits)`*

Computes time-averaged quantities based on linear interpolation.

Inputs are:

* `timevec`: numeric vector of time intervals.  
* `benefits`: numeric vector of values to be interpolated.  

Function returns a time-averaged value over the specified time horizon.

```{r echo=TRUE}
annualizer
```


*`CEfinder(benefit, cost)`*

Returns cost-effectiveness analysis for a particular set of alternatives.

Inputs are:

* `benefit`: a vector of restoration benefits. Typically, these are time-averaged ecological outcomes (e.g., average annual habitat units). Often project benefits are best presented as the "lift" associated with a restoration action(i.e., the benefits of an alternative minus the benefits of a "no action" plan).  
* `cost`: a vector of restoration costs. Typically, these are monetary costs associated with a given restoration action such as project first cost or annualized economic cost. Notably, these functions are agnostic to units, so costs could also be non-monetary such as lost political capital or social costs of each alternative.  

Function returns a numeric vector identifying each plan as cost-effective (1) or non-cost-effective (0). The cost-effective actions comprise the Pareto frontier of non-dominated alternatives at a given level of cost or benefit.


```{r echo=TRUE}
CEfinder
```


*`BBfinder(benefit, cost, CE)`*

Examines the slope of the cost-effectiveness frontier to isolate how unit cost (cost/benefit) increases with increasing environmental benefit. Restoration actions with the lowest slope of unit cost are considered "best buys".

Inputs are:

* `benefit`: a vector of restoration benefits. Typically, these are time-averagedecological outcomes (e.g., average annual habitat units). Often project benefits are best presented as the "lift" associated with a restoration action(i.e., the benefits of an alternative minus the benefits of a "no action" plan).  
* `cost`: a vector of restoration costs. Typically, these are monetary costs associated with a given restoration action such as project first cost or annualized economic cost. Notably, these functions are agnostic to units, so costs could also be non-monetary such as lost political capital or social costs of each alternative.  
* `CE`: numeric vector of 0's and 1's indicating whether a plan is cost-effective (1) or non-cost-effective (0). Can be derived from `CEfinder`.  

Function returns a list with summaries of all restoration actions as well as best buy plans only.


```{r echo=TRUE}
BBfinder
```


*`CEICAplotter(altnames, benefit, cost, CE, BB, figure.name)`*

Plots summary outputs of Cost-effective Incremental Cost Analysis (CEICA) in *.jpeg format.

Inputs are:

* `altnames`: a vector of numerics or characters as unique restoration action identifiers.  
* `benefit`: a vector of restoration benefits. Typically, these are time-averagedecological outcomes (e.g., average annual habitat units). Often project benefits are best presented as the "lift" associated with a restoration action(i.e., the benefits of an alternative minus the benefits of a "no action" plan).  
* `cost`: a vector of restoration costs. Typically, these are monetary costs associated with a given restoration action such as project first cost or annualized economic cost. Notably, these functions are agnostic to units, so costs could also be non-monetary such as lost political capital or social costs of each alternative.  
* `CE`: numeric vector of 0's and 1's indicating whether a plan is cost-effective (1) or non-cost-effective (0). Can be derived from `CEfinder`.  
* `BB`: numeric vector of 0's and 1's indicating whether a plan is a best buy (1) or not (0). Can be derived by isolating select outputs from `BBfinder`.  
* `figure.name`: output figure file name structured as "filename.jpeg".  

Function returns a multi-panel *.jpeg figure summarizing cost-effectiveness and incremental cost analysesvalue of habitat quality from 0 to 1 ignoring NA values.


```{r echo=TRUE}
CEICAplotter
```


#### *3.4. ecorest Web Application*  


**Insert description of the Shiny app once complete. The goal of this section is to describe app construction and basic flow of logic (testing will be described below).**


## **4. Evaluation**


**In general think both about a priori quality assurance and post hoc quality control**


Ecological models typically rely on multiple variables, ecological processes, and in many cases present a variety of ecological outcomes. As such, models can quickly become complex system representations with many components, inputs, assumptions, and modules. Model evaluation is the process for ensuring that numerical tools are scientifically defensible and transparently developed. Evaluation is often referred to as verification or validation, but it in fact includes a family of methods ranging from peer review to model testing to error checking (Schmolke et al. 2010). In this more general sense, evaluation should include the following (Grant and Swannack 2008): (1) assessing the reasonableness of model structure, (2) assessing functional relationships and verifying code, (3) evaluating model behavior relative to expected patterns, (4) comparing outcomes to empirical data, if possible, and (5) analyzing uncertainty in predictions. The USACE has established an ecological model certification process to ensure that planning models are sound and functional. These generally consist of evaluating tools relative to the three following categories: technical quality, system quality, and usability (EC 1105-2-412).


#### *4.1. System Quality*  


System quality: Does the model work the way we say it works?  Numerical accuracy of the model / code verification.  Does the calculator work?  Quality assurance measures taken (e.g., coding practices, code checking).  Quality control (testing plan, model breaking points).  Error outputs. 


Reviewed at CRAN


```{r}
#Insert model testing

```


#### *4.2. Technical Quality*  


Technical quality: This is the scientific evaluation of the model.  Describe what makes the models of the appropriate or highest scientific quality (e.g., literature basis).  What is the effect of any one variable on the outcome (analysis that answers question ‚Äì global sensitivity analysis of model structure)?  Does the model structure make sense?  How uncertain are model variables?  Are parameters repeatable, reliable, and transparent?  Limitations in terms of breaking points of the model (parametric).  Verification exercise?  Validation exercise?  Goodness of fit?  Pattern oriented modeling?  Turing test?


Not really applicable

Mention sensitivity analysis and associated appendix


```{r}
#Insert technical quality testing
#Verification / validation figures
#Statistical tests
#Sensitivity analyses

```


#### *4.3. Usability*  


Usability: Model software / hardware availability or requirements (e.g., ACE-IT approval). Input data availability, formatting, and processing.  Output format and processing. Training availability.  Technical support by developer, model documents, etc. Model accessibility (e.g., open source code, web-service, version control). Proprietary / black box? 

Other considerations: USACE policy compliance and conformance. End-user capability. Adaptability for future applications (same system new data, different systems). Archival (code, model maintenance, new programming languages, etc.).


In general for USACE: R is globally available and free. R is ACE-IT approved. Simple formating. 


Within R-package:  

* Help documentation  
* Help includes examples
* Insert.  

Within shiny app:  

* Insert  
* Insert  



## **5. Application and Communication**


Provide a brief walk-through of application of each function. Appendix provides integrated examples of functions used together for ecosystem restoration decisions. Other appendix provides user's guide.


Considerations for Application: What are some of the key limitations (geographic, numerical, system type)?  Look back at conceptual model limits, numerical limits, etc.  This should be a synthesis for future teams.  What‚Äôs not in the model that the user needs to know about?


Future improvement:  

* Add more models: modified mink, modified bluegill, oyster, HGM, etc.  
* Planned adaptation of the model.  
* Key research needs.  


Communication  

* Identify audience: Who is using the results of the model?  
* Visualization: How are data used, interpreted, presented?  Can this be modified to increase understanding of the model?  
* Develop communication plan: What is the target?  Training plans, tutorials, outreach.  Community adoption strategy ‚Äì what is the sales plan?


## **6. Summary**


Insert brief review with some highlights. Major approach? Key findings? Model limitations?


## **Acknowledgements**


Funding: EMRRP

Ideas and collaboration: Nate Richards, Tyler Keys, Christina Saltus, Brook Herman, Carra Carrillo

Testers: Michael Dougherty, Mick Porter, Danny Allen, Robin Armetta, etc.


## **References**


Allen, A.W. 1987. Habitat suitability index models: barred owl. U.S. Fish Wild. Serv. Biol. Rep. 82(10.143). 17 pp

Brinson M.M. 1993. A hydrogeomorphic classification for wetlands. Technical Report WRP-DE-4. Vicksburg, MS: U.S. Army Engineer Waterway Experiment Station.

Carrillo C., McKay S.K., and Swannack T.S. 2020. Ecological Model Development: Toolkit for interActive Modeling (TAM). ERDC TN-EMRRP-??.  U.S. Army Engineer Research and Development Center, Vicksburg, Mississippi.

Fischenich J.C. 2008. The application of conceptual models to ecosystem restoration. ERDC TN-EBA-TN-08-1. U.S. Army Engineer Research and Development Center, Vicksburg, Mississippi.

Grant W.E. and Swannack T.M. 2008. Ecological modeling: A common-sense approach to theory and practice. Malden, MA: Blackwell Publishing.

Herman B.D., McKay S.K., Altman S., Richards N.S., Reif M., Piercy C.D., and Swannack T.M. 2019. Unpacking the black box: Demystifying ecological models through mediated modeling and hands-on learning. Frontiers in Environmental Science, 7 (122), doi: 10.3389/fenvs.2019.00122.

Hijmans R.J. and Ghosh A. 2019. Spatial data analysis with R. https://rspatial.org/. 

McKay S.K.  2009.  Reducing spreadsheet errors.  ERDC TN-EMRRP-EBA-03.  U.S. Army Engineer Research and Development Center, Vicksburg, Mississippi.

McKay S.K. and Hern√°ndez-Abrams D.D. 2020. Package ‚Äòecorest‚Äô. CRAN Reference Manual. https://cran.r-project.org/web/packages/ecorest/ecorest.pdf. 

McKay S.K., Pruitt B.A., Zettle B., Hallberg N., Hughes C., Annaert A., Ladart M., and McDonald J. 2018a. Proctor Creek Ecological Model (PCEM): Phase 1-Site screening.  ERDC/EL TR-18-11. U.S. Army Engineer Research and Development Center, Vicksburg, Mississippi.

McKay S.K., Pruitt B.A., Zettle B.A., Hallberg N., Moody V., Annaert A., Ladart M., Hayden M., and McDonald J. 2018b. Proctor Creek Ecological Model (PCEM): Phase 2-Benefits analysis. ERDC/EL TR-18-11. U.S. Army Engineer Research and Development Center, Vicksburg, Mississippi.  

McKay S.K., Richards N., and Swannack T.  2019.  Aligning ecological model development with restoration project planning.  ERDC EMRRP-SR-89.  U.S. Army Engineer Research and Development Center, Vicksburg, Mississippi.

McMahin, TE, JW Terrell, and PC Nelson. 1984. Habitat suitability information: Walleye. U.S. Fish Wildl. Serv. FWS/OBS-82/10.56. 43 pp. 

Palesh G. and Anderson D. 1990. Modification of the habitat suitability index model for the bluegill (Lepomis macrochirus) for winter conditions for the Upper Mississippi River backwater habitats. 

R Core Team. 2019. R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.

Robinson R. Hansen W., and Orth K. 1995. Evaluation of environmental investments procedures manual interim: Cost effectiveness and incremental cost analyses. IWR Report 95-R-1. Institute for Water Resources, U.S. Army Corps of Engineers, Alexandria, Virginia.  

Smith R.D., Ammann A., Bartoldus C., and Brinson M.M. 1995. An approach for assessing wetland functions using hydrogeomorphic classification, reference wetlands, and functional indices. Technical Report WRP-DE-9. Vicksburg, MS: Army Engineer Waterways Experiment Station.

Stuber R.J., Gebhart G., and Maughan O.E. 1982. Habitat suitability index models: Bluegill. U.S.D.I. Fish and Wildlife Service. FWS/OBS-82/10.8. 26 pp.

Swannack T.M., Fischenich J.C., and Tazik D.J. 2012. Ecological modeling guide for ecosystem restoration and management. ERDC/EL TR-12-18. Vicksburg, MS: U.S. Army Engineer Research and Development Center.

Swannack T.M., Reif M., and Soniat T.M. 2014. A robust, spatially explicit model for identifying oyster restoration sites: Case studies on the Atlantic and Gulf Coasts. Journal of Shellfish Research, 33 (2), 395-408.

Tirpak J.M., Jones Farrand D., Thompson F.R., Twedt D.J., Baxter C.K., Fitzgerald J.A., and Uihlein W.B. 2009. Assessing ecoregional scale habitat suitability index models for priority landbirds. The Journal of Wildlife Management 73:1307-1315.

U.S. Army Corps of Engineers (USACE). 1999. Civil Works Ecosystem Restoration Policy. ER 1165-2-501. U.S. Army Corps of Engineers, Washington, D.C.

USACE. 2000. Planning Guidance Notebook. ER-1105-2-100. U.S. Army Corps of Engineers, Washington, D.C.

USACE. 2011. Assuring quality of planning models. EC-1105-2-412. Washington, DC. U.S. Army Corps of Engineers.

USACE. 2014. Appendix C: Environment. EC-11-2-206. Headquarters, USACE, Washington, D.C.

US Fish and Wildlife Service. (1980a). Habitat as a basis for environmental assessment. Ecological Services Manual, 101.

US Fish and Wildlife Service. (1980b). Habitat Evaluation Procedures (HEP). Ecological Services Manual, 102.

US Fish and Wildlife Service. (1981). Standards for the Development of Habitat Suitability Index Models. Ecological Services Manual, 103.


## **Appendix A: Glossary and Acronyms**


* *Eco-PCX*: U.S. Army Corps of Engineers' ecosystem restoration planning center of expertise.  
* *[ecorest](https://cran.r-project.org/web/packages/ecorest/index.html)*: R-package for conducting analyses informing ecosystem restoration decisions as described in this document.
* *ERDC*: U.S. Army Engineer Research and Development Center.  
* *FWOP*: Future WithOut Project Conditions.
* *[R](https://cran.r-project.org/)*: Statistical software language used to program ecorest (R Core Team 2019).  
* *[shiny](https://shiny.rstudio.com/)*: R package that makes it easy to build interactive web apps straight from R.  
* *USACE*: U.S. Army Corps of Engineers.  
* *USFWS*: U.S. Fish and Wildlife Service.  


## **Appendix B: USFWS Habitat Suitability Models included in ecorest**


```{r}
#Compile and return a table of key metadata properties for each model
ecorest.metadata.summary <- cbind(paste(HSImetadata$model), paste(HSImetadata$species), paste(HSImetadata$documentation), 
                                  eval(paste("[pdf](", HSImetadata$website, ")", sep="")))
colnames(ecorest.metadata.summary) <- c("Model Name", "Taxa", "Documentation", "Link")
knitr::kable(ecorest.metadata.summary, caption="Table B-1. USFWS Habitat Suitability Index models included in ecorest.", align="c")
```


```{r}
#Import the naming rubric for all of the variables
ecorest.naming.rubric <- read.csv("HSI.Naming.Convention.csv", header=TRUE)

#Return a summary table showing the rubric
knitr::kable(ecorest.naming.rubric, caption="Table B-2. Standardized variable naming convention used in defining USFWS HSI models.")
```


## **Appendix C: Model Test Plan**


Insert comprehensive model testing documentation.


## **Appendix D: Example of Sensitivity Analysis**


Insert example based on SMURF code.


## **Appendix E: User's Guide**


Step-by-step (screenshot-style) guide for use.  How is the model applied?  Differences in scenarios?  Experimental design for model runs?  Range of uncertainty analyzed in model runs?  

Insert step-by-step guide to model application with R only.


Insert step-by-step guide to model application with shiny only. Mostly screenshots with labeled steps.


## **Appendix F: Example Applications**


Insert overview of applications:  

* Single-site existing condition assessment with multiple existing models (Savannah River)  
* Modified HSI model (bluegill or modified mink)  
* User-specified model (Swannack oyster)  
* Impact assessment (DDHA/Jung/Fischer)  
* Comparison of Single-Site Habitat Restoration Alternatives (Huron Island)  
* Multi-site Restoration Prioritization (Hudson River)  
* Comparison of Non-Habitat Restoration Alternatives (HRE social)   
* Spatial data example? (NJBB)  


#### *F.1. Insert*  

Insert.


#### *F.2. User-specified Model: Oyster Restoration*  

Insert.



```{r echo=TRUE}
#Import suitability curves naming rubric for all of the variables
oyster.SI <- read.csv("HSI.Swannack.oyster.csv", header=TRUE)

#Assemble random input sets for multiple hypothetical sites
noyster <- 10
input.oyster <- matrix(0,nrow=noyster,ncol=5)
input.oyster[,1] <- runif(noyster) #Percent of bottom with hard substrate (%)
input.oyster[,2] <- runif(noyster, min=0, max=30) #Mean salinity during spawning season (ppt)
input.oyster[,3] <- runif(noyster, min=0, max=15) #Minimum annual salinity (ppt)
input.oyster[,4] <- runif(noyster, min=0, max=30) #Mean annual salinity (ppt)
input.oyster[,5] <- runif(noyster, min=0, max=100) #Site area (acres)

#Loop over each site to compute variable suitability and total HSI
output.oyster.SI <- matrix(0,nrow=noyster,ncol=4)
output.oyster.HU <- data.frame(matrix(0,nrow=noyster,ncol=3))
for(i in 1:noyster){
  #Compute suitability relative to each variable
  output.oyster.SI[i,] <- SIcalc(oyster.SI, input.oyster[i,1:4])
  
  #Compute habitat units
  output.oyster.HU[i,] <- HUcalc(output.oyster.SI[i,], input.oyster[i,5], HSIgeomean)
}

#Create summary table
oyster.output <- cbind(round(input.oyster,2), round(output.oyster.SI,2), round(output.oyster.HU,2))
oyster.output <- data.frame(oyster.output)
colnames(oyster.output) <- c("Percent cultch (%)", "Mean salinity during spawning season (ppt)", "Minimum annual salinity (ppt)", "Mean annual salinity (ppt)", "Site area (acres)", "SI.cultch", "SI.MSSS", "SI.MAS", "SI.AS", "HSI", "Area (ac)", "Habitat Units")

#Return a summary table showing the rubric
knitr::kable(oyster.output, caption="Table F-2. Summary of oyster restoration example.")
```


## **Appendix G: USACE Model Certification Review**


Review comments were received on XXX. All comments follow the four-part comment structure of: (1) identify the problem, (2) describe the technical basis for the comment, (3) rate the significance or impact of the problem, and (4) recommend a mechanism for resolution.


#### *G.1. Reviewer 1 (John Smith, USACE XXX District)*  

*Comment 1.1: Insert.*  

* Basis: Insert.  
* Significance: Insert.  
* Resolution: Insert.  
* Author Response: Insert.

*Comment 1.2: Insert.*  

* Basis: Insert.  
* Significance: Insert.  
* Resolution: Insert.  
* Author Response: Insert.


#### *G.2. Reviewer 2 (Jane Smith, USACE YYY District)*  

*Comment 2.1: Insert.*  

* Basis: Insert.  
* Significance: Insert.  
* Resolution: Insert.  
* Author Response: Insert.

*Comment 2.2: Insert.*  

* Basis: Insert.  
* Significance: Insert.  
* Resolution: Insert.  
* Author Response: Insert.


#### *G.3. Reviewer 3 (John Smith, USACE YYY District)*  

*Comment 3.1: Insert.*  

* Basis: Insert.  
* Significance: Insert.  
* Resolution: Insert.  
* Author Response: Insert.

*Comment 3.2: Insert.*  

* Basis: Insert.  
* Significance: Insert.  
* Resolution: Insert.  
* Author Response: Insert.
